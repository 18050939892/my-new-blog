---
author: Sat Naing
pubDatetime: 2022-08-21T04:58:53Z
title: npm run build和astro-paper项目部署vercel时可能遇到的问题
slug: npm run build和astro-paper项目部署vercel时可能遇到的问题
featured: true
draft: false
tags:
  - configuration
  - docs
description: Problems you may encounter when deploying vercel with npm run build and astro-paper project.
---
1. 在npm run build项目的时候，我们可能会遇到以下报错
```html
'cp' 不是内部或外部命令，也不是可运行的程序
或批处理文件。
```
这个报错是因为操作系统不支持npm run build过程中涉及的cp，并且从这个报错可得知该项目属于Linux项目，想要解决这个问题，，就需要修改一下package.json文件中的build
```html
//把
"build": "astro check && astro build && pagefind --site dist && cp -r dist/pagefind public/"
//改成
"build": "astro check && astro build && pagefind --site dist && xcopy dist\\pagefind public\\pagefind\\ /E /I /Y"
```
2. 在部署项目到vercel上时，可能会遇见如下报错：
```html
[21:24:08.854] Running build in Washington, D.C., USA (East) – iad1
[21:24:08.876] Cloning github.com/18050939892/my-new-blog (Branch: main, Commit: b84d64f)
[21:24:09.917] Previous build caches not available
[21:24:10.076] Cloning completed: 1.199s
[21:24:10.776] Running "vercel build"
[21:24:11.320] Vercel CLI 41.7.0
[21:24:12.214] Detected pnpm-lock.yaml 9 which may be generated by pnpm@9.x or pnpm@10.x
[21:24:12.215] Using pnpm@10.x based on project creation date
[21:24:12.215] To use pnpm@9.x, manually opt in using corepack (https://vercel.com/docs/deployments/configure-a-build#corepack)
[21:24:12.216] Running "install" command: npm install...
[21:24:27.539]
[21:24:27.540] added 667 packages, and audited 668 packages in 15s
[21:24:27.541]
[21:24:27.541] 220 packages are looking for funding
[21:24:27.542] run npm fund for details
[21:24:27.542]
[21:24:27.542] found 0 vulnerabilities
[21:24:28.088]
[21:24:28.089] > astro-paper@5.2.0 build
[21:24:28.090] > astro check && astro build && pagefind --site dist && xcopy dist\pagefind public\pagefind\ /E /I /Y
[21:24:28.090]
[21:24:32.178] 13:24:32 [content] Syncing content
[21:24:35.958] 13:24:35 [content] Synced content
[21:24:35.959] 13:24:35 [types] Generated 4.97s
[21:24:35.972] 13:24:35 [check] Getting diagnostics for Astro files in /vercel/path0...
[21:24:45.046] Result (48 files):
[21:24:45.046] - 0 errors
[21:24:45.048] - 0 warnings
[21:24:45.048] - 0 hints
[21:24:45.048]
[21:24:47.838] 13:24:47 [content] Syncing content
[21:24:47.892] 13:24:47 [content] Synced content
[21:24:47.893] 13:24:47 [types] Generated 688ms
[21:24:47.894] 13:24:47 [build] output: "static"
[21:24:47.895] 13:24:47 [build] mode: "static"
[21:24:47.895] 13:24:47 [build] directory: /vercel/path0/dist/
[21:24:47.895] 13:24:47 [build] Collecting build info...
[21:24:47.896] 13:24:47 [build] ✓ Completed in 727ms.
[21:24:47.902] 13:24:47 [build] Building static entrypoints...
[21:24:51.295] 13:24:51 [vite] [32m✓ built in 3.34s[39m
[21:24:51.297] 13:24:51 [build] ✓ Completed in 3.40s.
[21:24:51.297]
[21:24:51.297] building client (vite)
[21:24:51.313] 13:24:51 [vite] transforming...
[21:24:52.940] 13:24:52 [vite] [32m✓[39m 48 modules transformed.
[21:24:53.093] 13:24:53 [vite] rendering chunks...
[21:24:53.211] 13:24:53 [vite] computing gzip size...
[21:24:53.224] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36msearch.astro_astro_type_script_index_0_lang.DXnQTGL-.js [39m[1m[2m 2.14 kB[22m[1m[22m[2m │ gzip: 1.07 kB[22m
[21:24:53.225] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36mindex.BVOCwoKb.js [39m[1m[2m 7.88 kB[22m[1m[22m[2m │ gzip: 3.05 kB[22m
[21:24:53.225] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36mClientRouter.astro_astro_type_script_index_0_lang.BZs-2RF_.js [39m[1m[2m 14.70 kB[22m[1m[22m[2m │ gzip: 5.02 kB[22m
[21:24:53.226] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36mComment.uImENI2E.js [39m[1m[2m 42.26 kB[22m[1m[22m[2m │ gzip: 13.56 kB[22m
[21:24:53.226] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36mui-core.Bw3IIvrC.js [39m[1m[2m 68.07 kB[22m[1m[22m[2m │ gzip: 21.71 kB[22m
[21:24:53.226] 13:24:53 [vite] [2mdist/[22m[2m_astro/[22m[36mclient.BPIbHqJh.js [39m[1m[2m179.41 kB[22m[1m[22m[2m │ gzip: 56.60 kB[22m
[21:24:53.227] 13:24:53 [vite] [32m✓ built in 1.92s[39m
[21:24:53.252]
[21:24:53.253] generating static routes
[21:24:53.378] 13:24:53 λ src/pages/og.png.ts
[21:24:54.660] 13:24:53 └─ /og.png (+1.28s)
[21:24:54.680] 13:24:54 λ src/pages/posts/[...slug]/index.png.ts
[21:24:54.902] 13:24:54 ├─ /posts/some-very-useful-websites/index.png (+200ms)
[21:24:55.065] 13:24:54 ├─ /posts/Compatibility-errors-encountered-when-using-astropaper/index.png (+163ms)
[21:24:55.231] 13:24:55 ├─ /posts/dynamic-og-image-generation-in-astropaper-blog-posts/index.png (+166ms)
[21:24:55.374] 13:24:55 ├─ /posts/customizing-astropaper-theme-color-schemes/index.png (+142ms)
[21:24:55.529] 13:24:55 ├─ /posts/common-commands-for-mongodb-database/index.png (+155ms)
[21:24:55.668] 13:24:55 ├─ /posts/astro-paper框架下的立即展示与更新展示/index.png (+139ms)
[21:24:55.874] 13:24:55 ├─ /posts/predefined-color-schemes/index.png (+206ms)
[21:24:56.081] 13:24:55 ├─ /posts/how-to-integrate-giscus-comments/index.png (+206ms)
[21:24:56.228] 13:24:56 ├─ /posts/how-to-add-latex-equations-in-blog-posts/index.png (+147ms)
[21:24:56.364] 13:24:56 ├─ /posts/astro-paper框架中的一些使用注意事项/index.png (+136ms)
[21:24:56.544] 13:24:56 ├─ /posts/request-promble/index.png (+180ms)
[21:24:56.678] 13:24:56 ├─ /posts/examples/how-do-i-develop-my-portfolio-and-blog/index.png (+134ms)
[21:24:56.807] 13:24:56 ├─ /posts/examples/tailwind-typography/index.png (+129ms)
[21:24:56.943] 13:24:56 └─ /posts/examples/how-do-i-develop-my-terminal-portfolio-website-with-react/index.png (+135ms)
[21:24:56.981] 13:24:56 ▶ src/pages/posts/[...page].astro
[21:24:57.006] 13:24:56 ├─ /posts/index.html (+22ms)
[21:24:57.017] 13:24:57 ├─ /posts/2/index.html (+12ms)
[21:24:57.024] 13:24:57 ├─ /posts/3/index.html (+6ms)
[21:24:57.031] 13:24:57 ├─ /posts/4/index.html (+7ms)
[21:24:57.037] 13:24:57 └─ /posts/5/index.html (+5ms)
[21:24:57.039] 13:24:57 λ src/pages/robots.txt.ts
[21:24:57.041] 13:24:57 └─ /robots.txt (+1ms)
[21:24:57.059] 13:24:57 λ src/pages/rss.xml.ts
[21:24:57.069] 13:24:57 └─ /rss.xml (+10ms)
[21:24:57.075] 13:24:57 ▶ src/pages/search.astro
[21:24:57.079] 13:24:57 └─ /search/index.html (+4ms)
[21:24:57.097] 13:24:57 ▶ src/pages/tags/index.astro
[21:24:57.106] 13:24:57 └─ /tags/index.html (+9ms)
[21:24:57.112] 13:24:57 ▶ src/pages/about.md
[21:24:57.115] 13:24:57 └─ /about/index.html (+3ms)
[21:24:57.123] 13:24:57 ▶ src/pages/archives/index.astro
[21:24:57.143] 13:24:57 └─ /archives/index.html (+20ms)
[21:24:57.149] 13:24:57 ▶ src/pages/tags/[tag]/[...page].astro
[21:24:57.158] 13:24:57 ├─ /tags/astro/index.html (+6ms)
[21:24:57.169] 13:24:57 ├─ /tags/blog/index.html (+10ms)
[21:24:57.175] 13:24:57 ├─ /tags/color-schemes/index.html (+7ms)
[21:24:57.181] 13:24:57 ├─ /tags/configuration/index.html (+6ms)
[21:24:57.185] 13:24:57 ├─ /tags/context-api/index.html (+4ms)
[21:24:57.196] 13:24:57 ├─ /tags/docs/index.html (+5ms)
[21:24:57.197] 13:24:57 ├─ /tags/docs/2/index.html (+7ms)
[21:24:57.206] 13:24:57 ├─ /tags/docs/3/index.html (+5ms)
[21:24:57.213] 13:24:57 ├─ /tags/faq/index.html (+5ms)
[21:24:57.213] 13:24:57 ├─ /tags/headless-cms/index.html (+4ms)
[21:24:57.214] 13:24:57 ├─ /tags/java-script/index.html (+3ms)
[21:24:57.223] 13:24:57 ├─ /tags/next-js/index.html (+10ms)
[21:24:57.227] 13:24:57 ├─ /tags/react-js/index.html (+4ms)
[21:24:57.236] 13:24:57 ├─ /tags/release/index.html (+8ms)
[21:24:57.239] 13:24:57 ├─ /tags/release/2/index.html (+4ms)
[21:24:57.244] 13:24:57 ├─ /tags/styled-components/index.html (+5ms)
[21:24:57.249] 13:24:57 ├─ /tags/tailwind-css/index.html (+5ms)
[21:24:57.254] 13:24:57 └─ /tags/type-script/index.html (+4ms)
[21:24:57.263] 13:24:57 ▶ src/pages/index.astro
[21:24:57.272] 13:24:57 └─ /index.html (+9ms)
[21:24:57.279] 13:24:57 ▶ src/pages/posts/[...slug]/index.astro
[21:24:57.292] 13:24:57 ├─ /posts/some-very-useful-websites/index.html (+11ms)
[21:24:57.316] 13:24:57 ├─ /posts/Compatibility-errors-encountered-when-using-astropaper/index.html (+24ms)
[21:24:57.331] 13:24:57 ├─ /posts/dynamic-og-image-generation-in-astropaper-blog-posts/index.html (+15ms)
[21:24:57.360] 13:24:57 ├─ /posts/how-to-update-dependencies/index.html (+29ms)
[21:24:57.372] 13:24:57 ├─ /posts/customizing-astropaper-theme-color-schemes/index.html (+12ms)
[21:24:57.377] 13:24:57 ├─ /posts/common-commands-for-mongodb-database/index.html (+5ms)
[21:24:57.385] 13:24:57 ├─ /posts/astro-paper框架下的立即展示与更新展示/index.html (+9ms)
[21:24:57.393] 13:24:57 ├─ /posts/predefined-color-schemes/index.html (+7ms)
[21:24:57.406] 13:24:57 ├─ /posts/how-to-integrate-giscus-comments/index.html (+12ms)
[21:24:57.411] 13:24:57 ├─ /posts/how-to-add-latex-equations-in-blog-posts/index.html (+5ms)
[21:24:57.421] 13:24:57 ├─ /posts/astro-paper框架中的一些使用注意事项/index.html (+10ms)
[21:24:57.427] 13:24:57 ├─ /posts/request-promble/index.html (+5ms)
[21:24:57.432] 13:24:57 ├─ /posts/astro-paper-2/index.html (+5ms)
[21:24:57.448] 13:24:57 ├─ /posts/astro-paper-v3/index.html (+15ms)
[21:24:57.454] 13:24:57 ├─ /posts/astro-paper-v4/index.html (+6ms)
[21:24:57.464] 13:24:57 ├─ /posts/astro-paper-v5/index.html (+10ms)
[21:24:57.471] 13:24:57 ├─ /posts/examples/how-do-i-develop-my-portfolio-and-blog/index.html (+7ms)
[21:24:57.478] 13:24:57 ├─ /posts/examples/tailwind-typography/index.html (+7ms)
[21:24:57.484] 13:24:57 └─ /posts/examples/how-do-i-develop-my-terminal-portfolio-website-with-react/index.html (+5ms)
[21:24:57.484] 13:24:57 ✓ Completed in 4.25s.
[21:24:57.485]
[21:24:57.485] generating optimized images
[21:24:57.646] 13:24:57 ▶ /_astro/forrest-gump-quote.A3mC0z9n_xDi7o.webp (before: 274kB, after: 26kB) (+160ms) (1/4)
[21:24:58.097] 13:24:58 ▶ /_astro/AstroPaper-v3.uaW8qzSG_ZbIc3B.webp (before: 168kB, after: 71kB) (+611ms) (2/4)
[21:24:58.172] 13:24:58 ▶ /_astro/AstroPaper-v4.TylavUIc_2hhsBs.webp (before: 157kB, after: 70kB) (+526ms) (3/4)
[21:24:58.501] 13:24:58 ▶ /_astro/AstroPaper-v5.BKHVI1Ox_1txTYb.webp (before: 173kB, after: 67kB) (+402ms) (4/4)
[21:24:58.502] 13:24:58 ✓ Completed in 1.02s.
[21:24:58.502]
[21:24:58.529] 13:24:58 [@astrojs/sitemap] sitemap-index.xml created at dist
[21:24:58.529] 13:24:58 [build] 47 page(s) built in 11.36s
[21:24:58.530] 13:24:58 [build] Complete!
[21:24:58.657]
[21:24:58.657] Running Pagefind v1.3.0 (Extended)
[21:24:58.657] Running from: "/vercel/path0"
[21:24:58.658] Source: "dist"
[21:24:58.658] Output: "dist/pagefind"
[21:24:58.658]
[21:24:58.658] [Walking source directory]
[21:24:58.661] Found 47 files matching **/*.{html}
[21:24:58.661]
[21:24:58.661] [Parsing files]
[21:24:58.907] Found a data-pagefind-body element on the site.
[21:24:58.908] ↳ Ignoring pages without this tag.
[21:24:58.908]
[21:24:58.908] [Reading languages]
[21:24:58.910] Discovered 1 language: en
[21:24:58.910]
[21:24:58.910] [Building search indexes]
[21:24:58.926] Total:
[21:24:58.927] Indexed 1 language
[21:24:58.927] Indexed 19 pages
[21:24:58.927] Indexed 2349 words
[21:24:58.927] Indexed 0 filters
[21:24:58.927] Indexed 0 sorts
[21:24:58.953]
[21:24:58.953] Finished in 0.296 seconds
[21:24:58.962] sh: line 1: xcopy: command not found
[21:24:58.977] Error: Command "npm run build" exited with 127
[21:24:59.424]
[21:25:02.448] Exiting build container
```
这是因为项目构建时用到的xcopy命令是基于Windows的，也就是第一点改的结果，而 Vercel 的构建环境是基于 Linux的，因此
如果不只是构建项目，还要把项目部署到vercel上的话，就需要继续改：
首先继续改build配置
```html
"build": "astro check && astro build && pagefind --site dist && node scripts/copy-pagefind.js"

```
然后创建文件 scripts/copy-pagefind.js，内容如下：
```html
const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

// 检查操作系统
const isWindows = process.platform === 'win32';

try {
  // 确保目标目录存在
  const publicDir = path.join(process.cwd(), 'public');
  const publicPagefindDir = path.join(publicDir, 'pagefind');
  
  if (!fs.existsSync(publicDir)) {
    fs.mkdirSync(publicDir, { recursive: true });
  }
  
  // 根据操作系统执行不同命令
  if (isWindows) {
    execSync('xcopy dist\\pagefind public\\pagefind\\ /E /I /Y');
  } else {
    // 如果目标目录存在，先删除
    if (fs.existsSync(publicPagefindDir)) {
      execSync('rm -rf public/pagefind');
    }
    execSync('cp -r dist/pagefind public/pagefind');
  }
  
  console.log('Successfully copied pagefind files');
} catch (error) {
  console.error('Error copying pagefind files:', error);
  process.exit(1);
}
```
如此，便可解决兼容问题了
